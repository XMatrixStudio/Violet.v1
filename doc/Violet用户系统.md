# Violet用户系统

本系统提供统一的用户登陆体验

## 登陆方法：

密码模式： [用户提交信息到应用服务器，应用服务器与认证服务器交流]【只授权绝对可信网站】

1. 应用服务器直接发送用户名或邮箱地址和SHA512散列的密码POST(通过提供的SDK实现)到Violet系统指定接口[oauth.xmatrix.studio/api/login]

2. 认证服务器认证后返回结果，若成功，服务器返回用户信息[唯一ID，用户名，用户邮箱，用户访问令牌(1个月)，个人基础信息等]


缺陷：无法缓存violet用户中心的登陆状态（修改信息的时候需要重新登陆）



授权码模式[首选，推荐]：

1. 使用SDK里面的Login API重定向到Violet用户系统登陆页面(get参数：网站授权ID, 网站授权令牌,回调参数) (通过提供的SDK实现)
2. 用户在Violet用户系统的界面进行注册、邮箱认证或者登陆等操作，若登陆成功则重定向到网页的指定回溯地址【注册在Violet数据库】 (get参数：授权码(一次性，5分钟后失效))，然后Violet系统会在自身cookie设置一个加密令牌(24小时后失效，记住登陆状态15天后失效)，用作缓存用户登陆状态.
3. X网站发送授权码到应用服务器，应用服务器通过POST请求向Violet系统查询用户信息[唯一ID，用户名，用户邮箱，用户访问令牌(1个月)，个人基础信息等]。(通过提供的SDK实现)


### 返回授权码后应用服务器的操作：

​	接受到用户信息后检查自身用户数据库是否存在这个用户ID

​	若不存在，新建一条数据[用户ID，单次操作认证token，(...其他该系统特有的用户数据)]，[可选：要求用户输入昵称，或者直接使用唯一用户名作为昵称，然后再提供修改]

​	使用Violet提供的用户认证SDK，配置好认证系统和数据库。

### 认证系统配置：

​	联系Violet管理员，提交你的回溯地址，然后管理员会交给你网站唯一ID以及网站接入key(用与生成令牌)

​	准备认证失败后的处理函数，准备数据库接口以及表名配置。准备好密钥和签名配置，还有Violet提供的当前网站接入的key



## 修改用户信息

提供的功能： 修改个人基础信息(手机号、用户详细信息、个人主页)[info]、修改密码[pwd]

推荐方法： 重定向到Violet用户中心(已经缓存当前用户登陆状态)，通过get参数提交要使用的功能，就会自动重定向到指定页面。


## 安全解决方案

一、 暴力破解密码

​	1. 单次验证需要7s的间隔(5s?10s?)

​	2. 加入验证码系统（加？还是不加？）

二、

## Violet API列表

### 外部接口

修改信息接口：重定向到个人信息修改页面，并定位到指定的功能.

### 内部接口

密码登陆接口：提交用户名和散列的密码，返回用户信息

授权码登陆接口： 重定向到登陆界面并且返回回溯地址授权码

## Violet SDK列表

密码模式登陆 (API接口)

授权码登陆 (API接口) (生成网站授权令牌[实时变化的对称加密]，并重定向到引导登陆界面)

用户认证系统 (中间件)【建议部署在全局app.post()】

发送邮件给用户(利用用户访问令牌[固定的随机散列值]以及网站授权令牌POST请求Violet服务器)





## 开发进程

完成基本前端

完成主要功能和API

完成SDK工具

做好安全措施